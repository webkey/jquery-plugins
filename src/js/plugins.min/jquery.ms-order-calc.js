/*! jquery.ms-order-calc
 * Version: 2018.1.0
 * Author: Serhii Ilchenko
 * Description: Calculation of quantity and price of goods
 */
!function(e){function t(t,n){var i=this;i.config=e.extend(!0,{},o,n),i.element=t,i.callbacks(),i.calcAll(),i.changeNumber(),i.removeTimeout=0,i.config.warningRemove?(i.showWarningRemoveItem(),i.cancelRemoveItem()):i.immediateRemoveItem(),i.init()}var o={spinner:".order-calc__number-js",price:".order-calc__price-js",priceSum:".order-calc__price-sum-js",btnRemove:".order-calc__remove-js",row:"tr",totalResult:".order-calc__total-results-js",totalCount:".order-calc__counts-total-js",totalPrice:".order-calc__price-total-js",warningRemove:!1,warningRemoveDelay:3e3,objParams:{},tplRemoveItem:'<div><div><span>Товар удален</span> <a class="order-calc__cancel-js">Отмена</a></div></div>',classes:{init:"ms-order-calc--initialized",hasNotItems:"order-calc__hasnt-items"}};t.prototype.callbacks=function(){var t=this;e.each(t.config,function(e,o){"function"==typeof o&&t.element.on(e+".msOrderCalc",function(e,n){return o(e,t.element,n)})})},t.prototype.calcAll=function(){var t=this,o=0,n=t.element.find(t.config.spinner);e.each(n,function(){var n=e(this),i=+n.val();i&&(o++,t.createObjParams(n,i))}),t.calcTotalResult()},t.prototype.changeNumber=function(){var t=this;t.element.on("change spin",t.config.spinner,function(o,n){var i=e(this),r=n?n.value:+i.val();t.createObjParams(i,r),t.calcTotalResult()})},t.prototype.immediateRemoveItem=function(){var t=this;t.element.on("click",t.config.btnRemove,function(o){var n=e(this).closest(t.config.row),i=n.find(t.config.spinner).data("id");delete t.config.objParams[i],t.calcTotalResult(),t.removeItem(n),o.preventDefault()})},t.prototype.showWarningRemoveItem=function(){var t=this;t.element.on("click",t.config.btnRemove,function(o){var n=e(this).closest(t.config.row),i=n.children(),r=n.find(t.config.spinner).data("id");t.removeItem(t.element.find(".order-calc__remove-row-js")),n.addClass("order-calc__remove-row-js"),i.addClass("order-calc__remove-cell-js"),n.append(e(t.config.tplRemoveItem).clone().addClass("order-calc__remove-warning-js")),delete t.config.objParams[r],t.calcTotalResult(),t.element.trigger("showedWarningRemoveItem.msOrderCalc"),clearTimeout(t.removeTimeout),t.removeTimeout=setTimeout(function(){t.removeItem(n)},t.config.warningRemoveDelay),o.preventDefault()})},t.prototype.cancelRemoveItem=function(){var t=this;t.element.on("click",".order-calc__cancel-js",function(o){clearInterval(t.removeTimeout);var n=e(this).closest(t.config.row),i=n.children();n.removeClass("order-calc__remove-row-js"),i.removeClass("order-calc__remove-cell-js"),n.find(".order-calc__remove-warning-js").remove(),t.element.trigger("canceledRemoveItem.msOrderCalc"),t.calcAll(),o.preventDefault()})},t.prototype.removeItem=function(e){var t=this,o=e.find(t.config.spinner).data("id"),n=e.closest(t.element);e.remove(),delete t.config.objParams[o],t.calcAll(),t.element.trigger("removedItem.msOrderCalc"),n.find(t.config.price).length||(t.element.trigger("removedAllItems.msOrderCalc"),n.addClass(t.config.classes.hasNotItems))},t.prototype.createObjParams=function(t,o){var n=this,i=e(t).closest(n.config.row),r=i.find(n.config.price),c=r.data("price"),a=Math.round(c*o*100)/100,s=t.data("id");n.config.objParams[s]={count:o,price:c,priceSum:a},n.element.trigger("createdObjParams.msOrderCalc",n.config.objParams),r.attr("data-count-sum",o),r.attr("data-price-sum",a),i.find(n.config.priceSum).html(a)},t.prototype.calcTotalResult=function(){var e=this,t=e.sumParam(e.config.objParams,"count"),o=e.sumParam(e.config.objParams,"priceSum");e.element.trigger("getTotalResults.msOrderCalc",{totalCount:t,totalPrice:o}),e.element.find(e.config.totalCount).text(t),e.element.find(e.config.totalPrice).text(o)},t.prototype.sumParam=function(e,t){var o,n=0;for(o in e)n+=e[o][t];return Math.round(100*n)/100},t.prototype.init=function(){this.element.addClass(this.config.classes.init),this.element.trigger("created.msOrderCalc")},e.fn.msOrderCalc=function(o){"use strict";return this.each(function(){new t(e(this),o)})}}(jQuery),function(e){function t(t,n,i){var r=this;r.config=e.extend(!0,{},o,n),r.element=t,r.index=i,r.stopPropogation=".ms-popup-d__no-close-js",r.modifiers={init:"ms-popup-d--initialized",isOpen:"ms-popup-d--is-open"},r.callbacks(),r.config.outsideClick&&r.clickOutside(),r.config.escapeClick&&r.clickEscape(),r.eventOnOpener(),r.init()}var o={opener:".ms-popup-d__opener-js",popup:".ms-popup-d__popup-js",closeBtn:".ms-popup-d__close-js",outsideClick:!0,escapeClick:!0};t.prototype.callbacks=function(){var t=this;e.each(t.config,function(e,o){"function"==typeof o&&t.element.on(e+".simplePopupDinamic",function(e,n){return o(e,t.element,n)})})},t.prototype.eventOnOpener=function(){var t=this;t.element.on("click",t.config.opener,function(o){var n=e(this),i=n.attr("href").substring(1),r=e("#"+i);if(n.hasClass(t.modifiers.isOpen))return t.closePopup(),o.preventDefault(),void o.stopPropagation();e("."+t.modifiers.isOpen).length&&t.closePopup(),n.addClass(t.modifiers.isOpen),r.addClass(t.modifiers.isOpen),t.element.trigger("afterOpened.simplePopupDinamic"),o.preventDefault(),o.stopPropagation()}),e(t.config.closeBtn).on("click",function(e){t.closePopup(),e.preventDefault()})},t.prototype.clickOutside=function(){var t=this;e(document).on("click",function(o){e("."+t.modifiers.isOpen).length&&!e(o.target).closest(t.stopPropogation).length&&(t.closePopup(),o.stopPropagation())})},t.prototype.clickEscape=function(){var t=this;e(document).keyup(function(o){e("."+t.modifiers.isOpen).length&&27===o.keyCode&&t.closePopup()})},t.prototype.closePopup=function(){var t=this;e("."+t.modifiers.isOpen).removeClass(t.modifiers.isOpen),t.element.trigger("afterClosed.simplePopupDinamic")},t.prototype.init=function(){var e=this;this.element.addClass(e.modifiers.init),this.element.trigger("afterInit.simplePopupDinamic")},e.fn.simplePopupDinamic=function(o){return this.each(function(n){new t(e(this),o,n)})}}(jQuery);